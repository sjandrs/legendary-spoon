{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://converge.local/schemas/budget-v2.schema.json",
  "title": "Budget (v2 - Dimensional)",
  "description": "Dimensional budget keyed by a selected dimension (Cost Center or Project) with per-account rows and optional monthly distribution.",
  "type": "object",
  "$comment": "Primary enforcement schema (draft-07). Aligns to DRF serializers; server will enforce totals/relations.",
  "properties": {
    "id": { "type": "integer", "readOnly": true },
    "name": { "type": "string", "minLength": 1 },
    "budget_against": { "type": "string", "enum": ["Cost Center", "Project"] },
    "dimension_id": { "type": "integer", "minimum": 1, "$comment": "FK to Cost Center or Project depending on budget_against" },
    "year": { "type": "integer", "minimum": 1900, "maximum": 3000 },
    "monthly_distribution": { "type": ["integer", "null"], "$comment": "ID referencing MonthlyDistribution; null means even split" },
    "accounts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "ledger_account_id": { "type": "integer", "minimum": 1 },
          "budget_amount": { "type": "number", "minimum": 0 }
        },
        "required": ["ledger_account_id", "budget_amount"],
        "additionalProperties": false
      }
    },
    "created_by": { "type": "integer", "readOnly": true },
    "created_at": { "type": "string", "format": "date-time", "readOnly": true }
  },
  "required": ["name", "budget_against", "dimension_id", "year", "accounts"],
  "additionalProperties": false,
  "examples": [
    {
      "name": "FY2026 Marketing Budget",
      "budget_against": "Cost Center",
      "dimension_id": 10,
      "year": 2026,
      "monthly_distribution": 3,
      "accounts": [
        {"ledger_account_id": 5000, "budget_amount": 200000},
        {"ledger_account_id": 6100, "budget_amount": 120000}
      ]
    }
  ]
}
